<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bitc.full505_team2_project.mapper.BoardMapper">
  <!-- 게시글 리스트 불러오기 -->
  <select id="selectBoardList" resultType="com.bitc.full505_team2_project.dto.BoardDto">
    SELECT
      board_pk, board_title, board_writer,
      date_format(board_date, '%Y-%m-%d') AS board_date, board_visit_cnt
    FROM board
    WHERE board_delete_yn = 'N'
    ORDER BY board_pk desc
  </select>

  <!-- 게시글 상세 페이지 -->
  <select id="selectBoardDetail" resultType="com.bitc.full505_team2_project.dto.BoardDto" parameterType="int">
    SELECT board_pk, board_title, board_writer, board_content, date_format(board_date, '%Y-%m-%d') AS board_date,
    board_visit_cnt
    FROM board
    WHERE board_pk = #{boardPk}
  </select>

  <!-- 조회수 업데이트 -->
  <update id="updateHitCount" parameterType="int">
    UPDATE board
    SET board_visit_cnt = board_visit_cnt +1
    WHERE board_pk = #{boardPk}
  </update>

  <!-- 게시글 등록 -->
  <insert id="insertBoard" parameterType="com.bitc.full505_team2_project.dto.BoardDto" useGeneratedKeys="true" keyProperty="boardPk">
    INSERT INTO board (board_title, board_writer, board_content, board_date)
    VALUES (#{boardTitle}, #{boardWriter}, #{boardContent}, NOW())
  </insert>

  <!-- 게시글 수정 -->
  <update id="updateBoard" parameterType="com.bitc.full505_team2_project.dto.BoardDto">
    UPDATE board
    SET board_title = #{boardTitle},
        board_content = #{boardContent}
    WHERE board_pk = #{boardPk}
  </update>

  <!-- 게시글 삭제 -->
  <update id="deleteBoard" parameterType="int">
    UPDATE board
    SET board_delete_yn = 'Y'
    WHERE board_pk = #{boardPk}
  </update>

  <!-- 지정한 게시글의 첨부 파일 목록보기 -->
  <select id="selectBoardFileList" parameterType="int" resultType="com.bitc.full505_team2_project.dto.BoardFileDto">
    SELECT board_file_id, board_pk, board_ofile_name, board_sfile_name,
    format(ROUND(board_file_size/1024), 0) AS board_file_size
    FROM board_file
    WHERE board_pk = #{boardPk}
  </select>

  <!-- 첨부파일 정보 DB에 추가하기 -->
  <insert id="insertBoardFileList" parameterType="com.bitc.full505_team2_project.dto.BoardFileDto">
    INSERT INTO board_file(board_pk, board_ofile_name, board_sfile_name, board_file_size, board_created_date)
    VALUES
    <foreach collection="list" item="item" separator=",">
      (#{item.boardPk}, #{item.boardOfileName}, #{item.boardSfileName}, #{item.boardFileSize}, NOW())
    </foreach>
  </insert>


</mapper>

