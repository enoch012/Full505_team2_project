<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mypage</title>
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61D폴 블랑코 노래모음 GLwZJEdK2Kadq2F9CUG65"
          crossorigin="anonymous">
    <link href="/css/style.css" rel="stylesheet">
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
            crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>

    <style></style>
    <script th:inline="javascript">
        $(document).ready(function () {
            let movieTitle // 영화 제목
            let userLikeList; // 영화 좋아요(String 형식)
            let movieTitleList = []; // 영화 제목을 배열 형식으로 변경
            let moviename;
            userLikeList = [[${session.userLikeList}]];
            let userLikeListArray = userLikeList.split(",") // String 형식의 pk값을 ,을 기준으로 구별
            let userLikeListInt = userLikeListArray.map(Number); // STring 형식의 pk값을 Int로 변경

            function getInfo() { // int값인 userListListInt를 가지고 ajax활용하여 movieTitleList의 배열로 저장함
                return new Promise(function (resolve, reject) {
                    for (let i = 0; i < userLikeListInt.length; i++) {
                        $.ajax({
                            url: "/detail/getInfo/" + userLikeListInt[i],
                            type: "GET",
                            data: {},
                            success: function (data) {
                                movieTitle = data.movieTitle;
                                movieTitleList[i] = movieTitle
                            },
                            error: function () {
                                // 비동기 실행에 오류가 있을 경우 실행
                                reject("에러 발생");
                            }
                        });
                    }
                    resolve(movieTitleList)
                });
            }
            getInfo()
            console.log(movieTitleList)
            function movieDetail(moviename) {
                $.ajax({
                    url:"https://api.themoviedb.org/3/search/movie?api_key=ad2f7390e457d7dc76e7fda8dcae77b2&language=ko-KR&page=1&query="+moviename,
                    type:"GET",
                    data:{},
                    success: function (data){
                        const MovieDetailList = data.results;
                        const imageBaseUrl = "https://image.tmdb.org/t/p/w500"
                        if(movieTitleList > 0){
                            let tag = "<div class=\"card\">"
                            tag += "<div class=\"row g-0\">"
                            tag += "<div class=\"col-md-7\">"
                            tag += "<img src=\"\" alt=\"\" class=\"rounded-start\">"
                            tag += "</div>"
                            tag += "<div class=\"col-5\">"
                            tag += " <h3 class=\"card-title\"></h3>"
                            tag += " </div>"
                            tag += " </div>"
                            tag += " </div>"
                        }
                        }
                    })
            }
            console.log(movieTitleList)
            for(i = 0; i< movieTitleList.length; i++){
                moviename = movieTitleList[i];
                movieDetail(moviename)
            }

        })
    </script>
</head>
<body>

<!-- header 영역-->
<header th:replace="~{layout/header :: header-basic}"></header>

<!-- main 영역 -->
<div class="container">
    <div class="row">
        <div class="col-sm-3 mx-auto">
            <div class="my-3 d-grid gap-3">
                <a href="/member/correction" class="w-50 p-2 btn btn-success">회원 정보 수정</a>
            </div>
        </div>
        <div class="row p-4 mb-4 mt-5 bg-primary text-white">
            <p>회원정보 수정</p>
        </div>
        <div class="row p-4 mb-4 mt-5 bg-secondary text-white" id="div-likelist">
            <p>자기가 누른 좋아요 리스트</p>
            <div class="card">
                <div class="row g-0">
                    <div class="col-md-7">
                        <img src="" alt="" class="rounded-start">
                    </div>
                    <div class="col-5">
                        <h3 class="card-title"></h3>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<!--footer 영역-->
<footer th:replace="~{layout/footer :: footer-basic}"></footer>

</body>
</html>