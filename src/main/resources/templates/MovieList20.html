<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link href="/css/style.css" rel="stylesheet">
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"
            integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
    <style>

    </style>
</head>
<body>
<header th:replace="~{layout/header :: header-basic}"></header>
<main class="container-md my-4">
    <button type="button" class="btn btn-primary" id="btn-recall">이전</button>
    <button type="button" class="btn btn-primary" id="btn-next">다음</button>


    <script>

        $(document).ready(function () {
            // card로 만들어진 요소를 전부 지워주는 함수
            function deleteElement() {
                const element = document.getElementById('div_card');

                element.remove();
            }

            var PageNo = 1;

            function startajax(PageNo) { //ajax 사용하는 부분을 함수로 변환
                const urlStr = "https://api.themoviedb.org/3/movie/now_playing?language=ko&page=" + PageNo;
                $.ajax({
                    url: urlStr,
                    headers: {
                        Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJhZDJmNzM5MGU0NTdkN2RjNzZlN2ZkYThkY2FlNzdiMiIsInN1YiI6IjY0YTIyNDc0YzM5MGM1MDEyZDE3MjI0OCIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.AKhLoI3OcnRdvK3KNLBKIFzTJccVZv_WN40cgsMPjTY'
                    },
                    type: "GET",
                    data: {},
                    success: function (data) {
                        console.log(urlStr);
                        const MovieList = data.results;
                        const imageBaseUrl = "https://image.tmdb.org/t/p/w500" // 이미지 연결 베이스 링크
                        if (MovieList.length > 0) {
                            for (let i = 0; i < MovieList.length; i++) { // for문 돌려서 Movie리스트를 계속 띄워줌
                                let tag = "<div class=\"card\" style=\"height:750px;\" id=\"div_card\"><a class='text-decoration-none text-black' href='/detail/data/" + MovieList[i].title + "'>" // 디테일 페이지로 이동하기위한 링크 추가
                                tag += "<div class=\"row g-0\">"
                                tag += "<div class=\"col-md-5\">"
                                tag += "<img src=\"" + imageBaseUrl + MovieList[i].poster_path + "\" alt=\"그림 들어갈 부분\" class=\"img-fluid rounded-start\">"
                                tag += "</div>"
                                tag += "<div class=\"col-7 \">"
                                tag += "<div class=\"card-body\">"
                                tag += "<h5 class=\"card-title\">" + MovieList[i].title + "</h5>"
                                tag += "<p class=\"card-text\">" + MovieList[i].overview + "</p>"
                                tag += "<p class=\"card-text\">" + "평점" + MovieList[i].vote_average + "</p>"
                                tag += "</div>"
                                tag += "</div>"
                                tag += "</div>"
                                tag += "</a></div>"
                                $("main").append(tag);

                            }
                        } else {
                            alert("영화정보를 불러오는중 오류가 발생했습니다.")
                            history.back();
                        }
                    }
                })
            }

            startajax();
            $("#btn-recall").on("click", function () { // a 링크 누를시 화면 초기화 후 다시 화면 로드
                if (PageNo > 1) {
                    PageNo = PageNo - 1
                    console.log("Selected PageNo:", PageNo);
                    deleteElement();
                    startajax(PageNo)
                } else {
                    alert("첫 번째 페이지입니다! ")
                }
            })
            $("#btn-next").on("click", function () { // a 링크 누를시 화면 초기화 후 다시 화면 로드
                PageNo = PageNo + 1
                console.log("Selected PageNo:", PageNo);
                deleteElement()
                startajax(PageNo)
            })
        })
    </script>
</main>
<footer th:replace="~{layout/footer :: footer-basic}"></footer>
</body>
</html>